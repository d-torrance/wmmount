#!/usr/bin/make -f
# This is a -*- makefile -*-
# Modified from the sample debian/rules that uses debhelper.
# GNU copyright 1998 by Marcelo Magallon.
# GNU copyright 1997 by Joey Hess.

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

build: build-stamp
build-stamp:
	dh_testdir
	xmkmf -a
	# get rid of X's locale emulation...
	perl -pi -e 's/-DX_LOCALE//g;' Makefile
	$(MAKE) CC=c++ CXXDEBUGFLAGS="-g -O2"
	perl -pi -e 's:/usr/X11R6/lib/X11/:/usr/share/:g' \
	  < system.wmmount.eg \
	  > sample.wmmount
	touch build-stamp

clean:
	dh_testdir
	dh_testroot
	-$(MAKE) clean
	-rm Makefile build-stamp sample.wmmount
	dh_clean

# Build architecture-independent files here.
binary-indep: build
# We have nothing to do by default.

# Build architecture-dependent files here.
binary-arch: build
#	dh_testversion
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs
	install -s -m 0755 wmmount `pwd`/debian/tmp/usr/X11R6/bin/wmmount
	install -m 0755 debian/update-wmmountrc \
	  `pwd`/debian/tmp/usr/bin/update-wmmountrc
	cp EXTRAS/* `pwd`/debian/tmp/usr/share/wmmount/
	dh_installdocs README
	dh_installexamples sample.wmmount
	dh_installmenu
#	dh_installinit
#	dh_installcron
	dh_installmanpages
#	dh_undocumented wmmount.1x
	dh_installchangelogs
	dh_strip
	dh_compress
	dh_fixperms
#	dh_suidregister
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol -u-isp
#	dh_makeshlibs
	dh_md5sums
	dh_builddeb

source diff:                                                                  
	@echo >&2 'source and diff are obsolete - use dpkg-source -b'; false

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary
