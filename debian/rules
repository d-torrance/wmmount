#!/usr/bin/make -f
# Derived from Marcelo's file, and dh_make's example.

#export DH_VERBOSE=1

build: build-stamp
build-stamp:
	dh_testdir
	xmkmf
	$(MAKE) CDEBUGFLAGS="-g -O2 -Wall -fno-strength-reduce"
	perl -pi -e 's:/usr/X11R6/lib/X11/:/usr/share/:g' \
          < config/system.wmmount.eg > sample.wmmount
	touch $@

clean:
	dh_testdir
	dh_testroot
	[ ! -f Makefile ] || $(MAKE) clean
	dh_clean Makefile build-stamp sample.wmmount

binary-indep: build
# There are no architecture-independent files here.

binary-arch: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs usr/bin usr/share/wmmount
	$(MAKE) install install.man DESTDIR=`pwd`/debian/tmp
	install -m 755 debian/gen-wmmountrc `pwd`/debian/tmp/usr/bin
	cp -a lib/* `pwd`/debian/tmp/usr/share/wmmount
	dh_installdocs README
	dh_installchangelogs
	dh_installexamples sample.wmmount config/system.wmmount.sh
	dh_installmanpages
	dh_installmenu
	dh_strip
	dh_compress
	dh_fixperms
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary
